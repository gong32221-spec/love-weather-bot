name: Daily Weather Bot

on:
  schedule:
    # 北京时间 07:00 = UTC 23:00 (前一天)
    - cron: '0 23 * * *'
  
  # 允许手动测试
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    # 【这里改了！】不再读取 requirements.txt，直接强制安装
    - name: Install dependencies
      run: |
        pip install requests yagmail

    - name: Run bot
      env:
        MY_EMAIL: ${{ secrets.MY_EMAIL }}
        MY_PASSWORD: ${{ secrets.MY_PASSWORD }}
        MY_RECEIVER: ${{ secrets.MY_RECEIVER }}
      run: python main.py
